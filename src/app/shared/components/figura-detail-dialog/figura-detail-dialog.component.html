<div class="dialog-container scale-in">
    <button mat-icon-button class="close-btn" (click)="close()">
        <mat-icon>close</mat-icon>
    </button>

    <div class="gallery-section">
        <div class="main-image-container" (click)="openLightbox()">
            @if (!imageLoaded()) {
            <div class="skeleton main-image-skeleton"></div>
            }
            <img [src]="currentImage()" [alt]="data.nombre" class="main-image" [class.loaded]="imageLoaded()"
                (load)="onImageLoad()" />
            <div class="zoom-hint">
                <mat-icon>zoom_in</mat-icon>
            </div>
        </div>

        @if (allImages.length > 1) {
        <div class="thumbnails">
            @for (img of allImages; track img; let i = $index) {
            <img [src]="img" [alt]="'Imagen ' + (i + 1)" [class.active]="img === currentImage()"
                (click)="selectImage(img, i)" loading="lazy" class="thumbnail" />
            }
        </div>
        }
    </div>

    <div class="info-section">
        <h2 mat-dialog-title>{{ data.nombre }}</h2>

        <div class="precio-destacado">
            {{ data.precio | currency:'CLP':'symbol-narrow':'1.0-0' }}
        </div>

        <mat-dialog-content>
            @if (data.descripcionLarga) {
            <div class="info-block">
                <h4>Descripci√≥n</h4>
                <p>{{ data.descripcionLarga }}</p>
            </div>
            }

            @if (data.historia) {
            <div class="info-block">
                <h4>Historia</h4>
                <p>{{ data.historia }}</p>
            </div>
            }

            <div class="meta-info">
                <mat-chip-set>
                    <mat-chip>
                        <mat-icon matChipAvatar>calendar_today</mat-icon>
                        {{ data.fechaCompra | date:'mediumDate' }}
                    </mat-chip>
                    <mat-chip>
                        <mat-icon matChipAvatar>place</mat-icon>
                        {{ data.lugarCompra }}
                    </mat-chip>
                    @if (data.categoria) {
                    <mat-chip>
                        <mat-icon matChipAvatar>category</mat-icon>
                        {{ data.categoria }}
                    </mat-chip>
                    }
                </mat-chip-set>

                <!-- Share Buttons -->
                <div class="share-buttons">
                    <p class="share-label">Compartir:</p>
                    <div class="share-actions">
                        <button mat-mini-fab color="primary" (click)="shareWhatsApp()" title="Compartir en WhatsApp">
                            <mat-icon>chat</mat-icon>
                        </button>
                        <button mat-mini-fab class="instagram-btn" (click)="shareInstagram()"
                            title="Compartir en Instagram">
                            <mat-icon>photo_camera</mat-icon>
                        </button>
                        <button mat-mini-fab class="tiktok-btn" (click)="shareTikTok()" title="Compartir en TikTok">
                            <mat-icon>videocam</mat-icon>
                        </button>
                        @if (hasNativeShare) {
                        <button mat-mini-fab (click)="shareNative()" title="Compartir">
                            <mat-icon>share</mat-icon>
                        </button>
                        }
                    </div>
                </div>
            </div>
        </mat-dialog-content>
    </div>
</div>