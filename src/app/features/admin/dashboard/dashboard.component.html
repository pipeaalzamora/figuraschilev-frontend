<mat-sidenav-container class="dashboard-container">
    <mat-sidenav [mode]="isMobile() ? 'over' : 'side'" [opened]="sidenavOpened()" class="sidenav"
        (closedStart)="sidenavOpened.set(false)">
        <div class="sidenav-header">
            <h2>FigurasChileV</h2>
            <p>Panel Admin</p>
        </div>
        <mat-nav-list>
            <a mat-list-item class="active" (click)="closeSidenavOnMobile()">
                <mat-icon matListItemIcon>dashboard</mat-icon>
                <span matListItemTitle>Dashboard</span>
            </a>
            <a mat-list-item routerLink="/" (click)="closeSidenavOnMobile()">
                <mat-icon matListItemIcon>visibility</mat-icon>
                <span matListItemTitle>Ver Galería</span>
            </a>
        </mat-nav-list>
        <div class="sidenav-footer">
            <button mat-button class="theme-btn" (click)="toggleTheme()">
                <mat-icon>{{ isDark() ? 'light_mode' : 'dark_mode' }}</mat-icon>
                {{ isDark() ? 'Modo claro' : 'Modo oscuro' }}
            </button>
            <button mat-button (click)="logout()">
                <mat-icon>logout</mat-icon>
                Cerrar sesión
            </button>
        </div>
    </mat-sidenav>

    <mat-sidenav-content class="main-content">
        <mat-toolbar>
            <button mat-icon-button (click)="toggleSidenav()" class="menu-btn">
                <mat-icon>{{ sidenavOpened() ? 'menu_open' : 'menu' }}</mat-icon>
            </button>
            <span>Gestión de Figuras</span>
            <span class="spacer"></span>
            <button mat-raised-button color="primary" (click)="openForm()">
                <mat-icon>add</mat-icon>
                <span class="btn-text">Nueva Figura</span>
            </button>
        </mat-toolbar>

        <div class="content-area">
            <div class="stats-cards">
                <div class="stat-card">
                    <div class="stat-icon collections">
                        <mat-icon>collections</mat-icon>
                    </div>
                    <div class="stat-info">
                        <span class="stat-value">{{ stats().totalFiguras }}</span>
                        <span class="stat-label">Total Figuras</span>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon money">
                        <mat-icon>attach_money</mat-icon>
                    </div>
                    <div class="stat-info">
                        <span class="stat-value">{{ stats().totalInvertido | currency:'CLP':'symbol-narrow':'1.0-0'
                            }}</span>
                        <span class="stat-label">Total Invertido</span>
                    </div>
                </div>
            </div>

            <div class="table-container">
                <table mat-table [dataSource]="figuras()" class="figuras-table">
                    <ng-container matColumnDef="imagen">
                        <th mat-header-cell *matHeaderCellDef>Imagen</th>
                        <td mat-cell *matCellDef="let figura">
                            <img [src]="figura.imagenPrincipal" [alt]="figura.nombre" loading="lazy"
                                class="table-image" />
                        </td>
                    </ng-container>

                    <ng-container matColumnDef="nombre">
                        <th mat-header-cell *matHeaderCellDef>Nombre</th>
                        <td mat-cell *matCellDef="let figura">
                            <div class="nombre-cell">
                                {{ figura.nombre }}
                                @if (figura.destacado) {
                                <mat-icon class="destacado-icon">star</mat-icon>
                                }
                            </div>
                        </td>
                    </ng-container>

                    <ng-container matColumnDef="precio">
                        <th mat-header-cell *matHeaderCellDef>Precio</th>
                        <td mat-cell *matCellDef="let figura" class="precio-cell">
                            {{ figura.precio | currency:'CLP':'symbol-narrow':'1.0-0' }}
                        </td>
                    </ng-container>

                    <ng-container matColumnDef="fecha">
                        <th mat-header-cell *matHeaderCellDef>Fecha Compra</th>
                        <td mat-cell *matCellDef="let figura">
                            {{ figura.fechaCompra | date:'shortDate' }}
                        </td>
                    </ng-container>

                    <ng-container matColumnDef="acciones">
                        <th mat-header-cell *matHeaderCellDef>Acciones</th>
                        <td mat-cell *matCellDef="let figura">
                            <button mat-icon-button [matMenuTriggerFor]="menu">
                                <mat-icon>more_vert</mat-icon>
                            </button>
                            <mat-menu #menu="matMenu">
                                <button mat-menu-item (click)="openForm(figura)">
                                    <mat-icon>edit</mat-icon>
                                    <span>Editar</span>
                                </button>
                                <button mat-menu-item (click)="deleteFigura(figura)" class="delete-item">
                                    <mat-icon>delete</mat-icon>
                                    <span>Eliminar</span>
                                </button>
                            </mat-menu>
                        </td>
                    </ng-container>

                    <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                    <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
                </table>

                @if (figuras().length === 0 && !loading()) {
                <div class="empty-table">
                    <mat-icon>inbox</mat-icon>
                    <p>No hay figuras registradas</p>
                    <button mat-raised-button color="primary" (click)="openForm()">
                        Agregar primera figura
                    </button>
                </div>
                }

                <mat-paginator [length]="totalItems()" [pageSize]="pageSize" [pageIndex]="currentPage() - 1"
                    [pageSizeOptions]="[10, 20, 50]" (page)="onPageChange($event)" showFirstLastButtons />
            </div>
        </div>
    </mat-sidenav-content>
</mat-sidenav-container>